<div id="AWLogin" onclick="antworkLogin_click()" disabled></div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fingerprintjs2/1.4.1/fingerprint2.min.js"></script>
<!-- script to login with antwork-->
<script>

	var appId = 'NAAPP'; //TO REPLACE VALUE BY REAL ANTWORK APPID
	var appDomain = 'http://localhost/'; //http://localhost:133/  TO REPLACE BY THE REAL DOMAN OF YOU SYSTEM SERVER
	var deviceToken = ''; //AUTOGENERATED BELOW 
	
    var AW;
    // script to test login with antwork
    $(document).ready(function () {
	new Fingerprint2().get(function(result, components){
			deviceToken = appId + result;
			$.ajaxSetup({ cache: true });
			//$.getScript('http://localhost:99/Helpers/externallogin_sdk.js', function () {
			$.getScript('https://members.antwork.com/Helpers/externallogin_sdk.js', function () {
				AW = new ExternalLogin();
				AW.init({
				   appId: appId,
				   appDomain: appDomain,
				   devicePlatform: 'WEB',
				   deviceToken: deviceToken,
				   version: 'v1.0',
				   status: true,
				   buttonId: 'AWLogin',
			   });
			   $('#AWLogin').removeAttr('disabled');
			});
		});
    });

    function antworkLogin_click()
    {
	    //debugger;
        AW.getLoginStatus(function (response) {
            //debugger;

            console.log(response);
            if (response.status === 'connected') {
                console.log('Logged in.');
                //console.log(response);
                
				var antworkUserID = response.authResponse.userID;
                var antworkUserToken = response.authResponse.accessToken;
                //alert(antworkUserID);
                performAntworkLogin(antworkUserID, antworkUserToken, deviceToken);
            }
            else {
                AW.login(function (response) {
                    console.log(response);
                    if (response.authResponse) {
                        
                        var antworkUserID = response.authResponse.userID;
						var antworkUserToken = response.authResponse.accessToken;
						performAntworkLogin(antworkUserID, antworkUserToken, deviceToken);

                        
                    } else {
                        console.log('User cancelled login or did not fully authorize.');
                    }
                }, { scope: 'email', return_scopes: true });
            }
        });	
    }

	function performAntworkLogin(antworkUserID, antworkUserToken, deviceToken)
	{
		//Call your system server and use EXTERNALAPPID = appId, EXTERNALAPPSECRET (only saved on the your system server), DEVICETOKEN = deviceToken, and TOKEN = antworkUserToken  to call the Antwork Server API (GetUserDetails) and:
		//1. check if returned Antwork User UserId = antworkUserID
	    //2. if all is good, use the returned Antwork User details to login to your system.  
	    $.ajax({

	        //url: 'https://EXTERNALSYSTEMSERVERAPI/SignInOrRegisterWithAntwork/',
	        url: 'http://localhost/testExternalAppServer-Antwork/SignInOrRegisterWithAntwork/',	
	        type: 'POST',
	        data: { deviceToken: deviceToken, antworkUserToken: antworkUserToken, antworkUserID: antworkUserID },
	        dataType: 'json',
	        error: function(xhr, textStatus, errorThrown) {
	            //alert(xhr.responseText);
	            console.log(xhr);
	            console.log(textStatus);
	            console.log(errorThrown);
	            console.log('external server api error: ' + xhr.responseText);
            },
	        success: function (data) {
	             console.log(data);
            },
	        
	    });
	}

</script>